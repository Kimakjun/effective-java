### zooKeeper

주키퍼란 데이터를 디렉터리 구조로 저장하고, 데이터가 변경되면 클라이언트에게 어떤 노드가 변경됐는지 콜백을 통해서 알려준다. 데이터를 저장할때 해당 세션이 유효한 동안 데이터가 저장되는 Ephemeral Node 와 데이터를 저장하는 순서에따라 자동으로 일련번호가 붙는 Sequence Node 라는 것도 존재한다.

#### 주키퍼가 데이터를 저장하는 방식

![](https://i.imgur.com/EyTa4NN.png)

특징: Persistent 를 유지하기 위해 트랜잭션 로그와 스냅샷 파일이 디스크에 저장되어 시스템을
재시작해도 데이터가 유지된다. 각각의 디렉터리 노드를 znode 라고 하며, 한번 설정한 이름은 변경
할 수 없고 스페이스를 포함 할 수 없다.

데이터를 저장 하는 기본 단위 노드

- Persistent Node
  명시적으로 삭제하지 않는 한 해당 데이터는 삭제되지 않는다.

- Ephemeral Node
  특정 노드를 생성한 세션이 유효한 동안 그노드의 데이터가 유효한 노드
  주키퍼 서버에 접속한 클라이언트가 특정 노드를 Ephemeral Node 로 생성했다면 해당 서버와 주키퍼
  서버간의 세션이 끊어지면 해당 노드는 자동으로 삭제된다. 이기능을 사용하면 클라이언트가 동작하는지
  여부를 판단할 수 있다.

- Sequence Node
  노드생성시 일련번호가 자동으로 붙는 노드. 해당 기능을 활용해 분산락등을 구현할 수 있다.

#### 주키퍼의 서버 구성도

![](https://i.imgur.com/YXOCf2M.png)

주키퍼 서버는 일반적으로 3대이상을 사용하며 서버 수는 주로 홀수로 구성한다.
서버간의 데이터 불일치가 발생하면 데이터 보정이 필요한데 이때 과반수 룰을 적용하기 때문에
서버를 홀수로 구성하는 것이 데이터 정합성 측면에서 유리하다.
주키퍼 서버는 리더와 팔로우로 구성되어있고 서버들끼리 자동으로 리더를 선정하며 모든 데이터 저장을 주도한다.

주키퍼는 데이터 저장소로 사용하는 것은 추천되지 않으며 주키퍼에서 추천하는 read/write 비율은 10:1 정도이다.

#### spring zooKeeper 활용

...
